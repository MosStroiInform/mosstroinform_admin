# üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–ó–∞–º–µ–Ω–∏–ª–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–∞ **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è** –æ—Ç JetBrains –∏ Google:

### ‚ùå –£–¥–∞–ª–µ–Ω–æ (—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –í–µ—Ä—Å–∏—è | –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å |
|-----------|--------|---------------------|
| `cafe.adriel.voyager` | 1.1.0 | –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏ |
| `com.russhwolf:multiplatform-settings` | 1.2.0 | –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫/—Ç–æ–∫–µ–Ω–æ–≤ |

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –í–µ—Ä—Å–∏—è | –û—Ç –∫–æ–≥–æ | –ó–∞—á–µ–º |
|-----------|--------|---------|-------|
| `androidx.navigation:navigation-compose` | 2.8.0-alpha10 | JetBrains | –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è Compose Multiplatform |
| `androidx.datastore:datastore-preferences-core` | 1.1.1 | Google/JetBrains | –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ |

---

## üéØ –ü–æ—á–µ–º—É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ª—É—á—à–µ?

### 1. **Navigation Compose (–≤–º–µ—Å—Ç–æ Voyager)**

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –æ—Ç JetBrains
- ‚úÖ **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –∏–∑ –∫–æ—Ä–æ–±–∫–∏ (—Å Kotlin Serialization)
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Android** (deep links, back stack)
- ‚úÖ **–ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞** –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö Google

#### Voyager –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- ‚ùå –°—Ç–æ—Ä–æ–Ω–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫)
- ‚ùå –ú–µ–Ω—å—à–µ –∫–æ–º—å—é–Ω–∏—Ç–∏ –∏ –ø—Ä–∏–º–µ—Ä–æ–≤
- ‚ùå –ú–æ–∂–µ—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å –æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π Compose
- ‚ùå –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

### 2. **DataStore (–≤–º–µ—Å—Ç–æ Multiplatform Settings)**

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞** –æ—Ç Google
- ‚úÖ **–ö–æ—Ä—É—Ç–∏–Ω—ã –∏–∑ –∫–æ—Ä–æ–±–∫–∏** (async –æ–ø–µ—Ä–∞—Ü–∏–∏)
- ‚úÖ **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —Å Preferences
- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è —Å SharedPreferences** - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è Google
- ‚úÖ **Flow API** –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### Multiplatform Settings –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- ‚ùå –°—Ç–æ—Ä–æ–Ω–Ω—è—è –æ–±—ë—Ä—Ç–∫–∞
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API (–±–ª–æ–∫–∏—Ä—É—é—â–∏–π)
- ‚ùå –ú–µ–Ω—å—à–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

---

## üìö –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

### 1. Navigation Compose

#### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ—É—Ç–æ–≤:
```kotlin
object Routes {
    const val AUTH = "auth"
    const val MAIN = "main"
    const val DASHBOARD = "dashboard"
}
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NavHost:
```kotlin
val navController = rememberNavController()

NavHost(
    navController = navController,
    startDestination = Routes.AUTH
) {
    composable(Routes.AUTH) {
        LoginScreen(
            onLoginSuccess = {
                navController.navigate(Routes.MAIN) {
                    popUpTo(Routes.AUTH) { inclusive = true }
                }
            }
        )
    }
    
    composable(Routes.MAIN) {
        MainScreen()
    }
}
```

#### –ù–∞–≤–∏–≥–∞—Ü–∏—è:
```kotlin
// –ü–µ—Ä–µ—Ö–æ–¥ –≤–ø–µ—Ä—ë–¥
navController.navigate(Routes.DASHBOARD)

// –ü–µ—Ä–µ—Ö–æ–¥ —Å –æ—á–∏—Å—Ç–∫–æ–π back stack
navController.navigate(Routes.MAIN) {
    popUpTo(Routes.AUTH) { inclusive = true }
}

// –ù–∞–∑–∞–¥
navController.popBackStack()
```

#### –° –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏:
```kotlin
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
composable(
    route = "project/{id}",
    arguments = listOf(navArgument("id") { type = NavType.StringType })
) { backStackEntry ->
    val id = backStackEntry.arguments?.getString("id")
    ProjectScreen(id = id!!)
}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è
navController.navigate("project/123")
```

### 2. DataStore

#### –°–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ expect/actual:
```kotlin
// commonMain
expect fun createDataStore(): DataStore<Preferences>

// androidMain
actual fun createDataStore(): DataStore<Preferences> {
    val context = LocalContext.current.applicationContext
    return context.dataStore
}

// jvmMain (Desktop)
actual fun createDataStore(): DataStore<Preferences> {
    return PreferenceDataStoreFactory.createWithPath(
        produceFile = { 
            File(System.getProperty("user.home"), ".app/prefs.pb").toPath()
        }
    )
}
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```kotlin
class TokenStorage(private val dataStore: DataStore<Preferences>) {
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    suspend fun saveToken(token: String) {
        dataStore.edit { preferences ->
            preferences[KEY_TOKEN] = token
        }
    }
    
    // –ß—Ç–µ–Ω–∏–µ
    suspend fun getToken(): String? {
        return dataStore.data.map { preferences ->
            preferences[KEY_TOKEN]
        }.first()
    }
    
    // Flow –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    val tokenFlow: Flow<String?> = dataStore.data.map { 
        it[KEY_TOKEN] 
    }
    
    companion object {
        private val KEY_TOKEN = stringPreferencesKey("token")
    }
}
```

#### DI —Å Koin:
```kotlin
val coreModule = module {
    single { createDataStore() }
    single { TokenStorage(get()) }
}
```

---

## üîÑ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### 1. TokenStorage

**–ë—ã–ª–æ (Settings):**
```kotlin
class TokenStorage(private val settings: Settings) {
    fun saveToken(token: String) {
        settings["token"] = token  // –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
    }
    
    fun getToken(): String? {
        return settings.getStringOrNull("token")
    }
}
```

**–°—Ç–∞–ª–æ (DataStore):**
```kotlin
class TokenStorage(private val dataStore: DataStore<Preferences>) {
    suspend fun saveToken(token: String) {
        dataStore.edit { preferences ->
            preferences[KEY_TOKEN] = token  // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —á–µ—Ä–µ–∑ –∫–æ—Ä—É—Ç–∏–Ω—ã
        }
    }
    
    suspend fun getToken(): String? {
        return dataStore.data.map { it[KEY_TOKEN] }.first()
    }
}
```

### 2. AuthRepository

**–ë—ã–ª–æ:**
```kotlin
fun isLoggedIn(): Boolean {
    return tokenStorage.getToken() != null  // –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
}
```

**–°—Ç–∞–ª–æ:**
```kotlin
suspend fun isLoggedIn(): Boolean {
    return tokenStorage.getToken() != null  // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
}
```

### 3. Navigation

**–ë—ã–ª–æ (Voyager):**
```kotlin
class LoginScreen : Screen {
    @Composable
    override fun Content() {
        val navigator = LocalNavigator.currentOrThrow
        LoginScreenContent(
            onSuccess = { navigator.push(MainScreen()) }
        )
    }
}
```

**–°—Ç–∞–ª–æ (Navigation Compose):**
```kotlin
@Composable
fun LoginScreen(onLoginSuccess: () -> Unit) {
    LoginScreenContent(onSuccess = onLoginSuccess)
}

// –í NavHost:
composable(Routes.AUTH) {
    LoginScreen(
        onLoginSuccess = {
            navController.navigate(Routes.MAIN)
        }
    )
}
```

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### DataStore vs Settings

| –û–ø–µ—Ä–∞—Ü–∏—è | Settings | DataStore |
|----------|----------|-----------|
| –ó–∞–ø–∏—Å—å | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (–±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫) | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (–∫–æ—Ä—É—Ç–∏–Ω–∞) |
| –ß—Ç–µ–Ω–∏–µ | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º |
| –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –ù–µ—Ç | –ï—Å—Ç—å (–∞—Ç–æ–º–∞—Ä–Ω—ã–µ) |
| –†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | –ù–µ—Ç | Flow API |
| –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | Weak | Strong |

### Navigation Compose vs Voyager

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Voyager | Navigation Compose |
|----------|---------|-------------------|
| Bundle size | ~50KB | ~200KB (–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è) |
| API —Å–ª–æ–∂–Ω–æ—Å—Ç—å | –ü—Ä–æ—Å—Ç–æ–π | –ß—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ, –Ω–æ –º–æ—â–Ω–µ–µ |
| Deep Links | –ë–∞–∑–æ–≤–∞—è | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ |
| Type-safety | Manual | Kotlinx.serialization |
| Back Stack | Custom | Android-native |

---

## üéØ –ò—Ç–æ–≥–∏

### –ü–ª—é—Å—ã –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –æ—Ç JetBrains/Google
- ‚úÖ **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**
- ‚úÖ **–õ—É—á—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –∏ –ø—Ä–∏–º–µ—Ä—ã
- ‚úÖ **–ë–æ–ª—å—à–æ–µ –∫–æ–º—å—é–Ω–∏—Ç–∏**
- ‚úÖ **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ **–ö–æ—Ä—É—Ç–∏–Ω—ã everywhere** (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å)
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Android best practices**

### –ú–∏–Ω—É—Å—ã:
- ‚ö†Ô∏è –ß—É—Ç—å –±–æ–ª—å—à–µ boilerplate –∫–æ–¥–∞ –¥–ª—è DataStore (expect/actual)
- ‚ö†Ô∏è Navigation Compose API –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ Voyager

### –í–µ—Ä–¥–∏–∫—Ç:
**–û–¥–Ω–æ–∑–Ω–∞—á–Ω–æ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏!** –û–Ω–∏ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ, –º–æ—â–Ω–µ–µ –∏ –±—É–¥—É—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –≥–æ–¥–∞–º–∏.

---

## üìñ –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Navigation Compose Docs](https://www.jetbrains.com/help/kotlin-multiplatform-dev/compose-navigation-routing.html)
- [DataStore Docs](https://developer.android.com/topic/libraries/architecture/datastore)
- [KMP Best Practices](https://kotlinlang.org/docs/multiplatform-mobile-understand-project-structure.html)

